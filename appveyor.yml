version: 1.0.{build}
image: Visual Studio 2015
environment:
  matrix:
  - COMPILER: "visual"
    CONFIGURATION: "Release"
    PLATFORM: "x64"
#  - COMPILER: "visual"
#    CONFIGURATION: "Release"
#    PLATFORM: "Win32"

install:
  - git submodule init third-party/Processlib
  - git submodule update
  - git submodule foreach "git checkout cmake_appveyor"
  - mkdir build
  - cd build
  - if [%PLATFORM%]==[x64] (
      appveyor.exe DownloadFile  http://ftp.esrf.fr/pub/bliss/lima/gsl-1.15-dev-win64.zip &&
      7z.exe x gsl-1.15-dev-win64.zip -o"c:\Program Files\gsl-1.15-win64" &&
      appveyor.exe DownloadFile https://sourceforge.net/projects/pyqt/files/sip/sip-4.19.3/sip-4.19.3.zip &&
      7z.exe x sip-4.19.3.zip  &&
      cd sip-4.19.3 &&
      python.exe configure.py &&
      nmake &&
      nmake install &&
      cd .. 
   )
  - if [%PLATFORM%]==[Win32] (
      appveyor.exe DownloadFile http://ftp.esrf.fr/pub/bliss/lima/gsl-1.8-lib.zip &&
      7z.exe x gsl-1.8-lib.zip -o"c:\Program Files\gsl-1.8-win32"
   )
  
 
build_script:
  - if [%PLATFORM%]==[x64] (
      cmake -G"Visual Studio 12 2013 Win64" -DLIMACAMERA_SIMULATOR=1  -DLIMA_ENABLE_PYTHON=1 ..
    )
  - if [%PLATFORM%]==[Win32] (
      cmake -G"Visual Studio 12 2013" -DLIMACAMERA_SIMULATOR=1 -DLIMA_ENABLE_TESTS=1 ..
    )
  - cmake --build . --config Release
    
    

test_script:
  - ctest -C Release --output-on-failure 
